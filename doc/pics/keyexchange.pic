.PS
figname = keyexchange;

dx = 0.15; dy = 0.15; m = 0.1;
h = 0.8; w = 0.4;
xh = 0.5; xw = 0.3;

boxht = h; boxwid = w;


right;
FN:  box "Frontend" "Node"; move m;
C1: box "Client" "Node1"; move m;
C2: box "Client" "Node2"; move m;
C3: box "Client" "Node3"; move m;
C4: box "Client" "Node4"; move m;
C5: box "Client" "Node5"; move m;
C6: box "Client" "Node6";
move left w*7+m*6;

down;

move down h;
move down h;

right;

KDS1: box "KDS"; move m;
KDS2: box "KDS"; move m; move m;

move up h/2 right (w*5+m*3)/2;

down;

DFS: box ht m*2 wid xw*6+m*5 "distributed file system (Ceph)";

move m;

move left (w*5+m*3)/2 down xh/2;

right;
boxht = xh; boxwid = xw;

MDS1: box "MDS"; move m;
MDS2: box "MDS"; move m;
box "..." wid (xw-m)/2 invis; move m;
OSD1: box "OSD"; move m;
OSD2: box "OSD"; move m;
OSD3: box "OSD"; move m;
box "..." wid (xw-m)/2 invis;

down;

# ellipse "$A$" wid w+dx ht h/4 at FN.n-(0,dy/2)

ellipse "job $A$" wid w ht h/5 at C1.n-(0,dy/2)
ellipse "job $A$" wid w ht h/5 at C2.n-(0,dy/2)
ellipse "job $A$" wid w ht h/5 at C3.n-(0,dy/2)
ellipse "job $A$" wid w ht h/5 at C4.n-(0,dy/2)
ellipse "job $A$" wid w ht h/5 at C5.n-(0,dy/2)
ellipse "job $A$" wid w ht h/5 at C6.n-(0,dy/2)

spline -> down m*2+dy from C2.sw+(m,dy) to KDS2.nw+(m,m*4) then down m*4+dy*2
spline <-> up m*4+dy from KDS2.nw+(m*2,-dy*2) to MDS1.nw+(m,m*6) then down m*6+dy
spline -> up m*6+dy from KDS2.nw+(m*3,-dy*2) to C2.sw+(m*3,-m*4) then up m*4+dy

"(1)$\mbox{key request: }path$" at C2.sw+(dx,-dy) rjust
"(2)$\mbox{attr request: }path, C_2$" at MDS1.n+(0,m*3+dy*2) ljust
"(3)$\mbox{attr response: }path,d,bs,E_{KU_A}(K_R),C_2,i_2,j_2$" at MDS1.n+(0,m*3+dy) ljust
"(4)$\mbox{key response: }path,d,bs,C_2,i_2,j_2,K_{i_2,j_2}$" at C2.sw+(m*3,-dy) ljust

.PE

